
@{
    ViewData["Title"] = "VerifyPasswordAsync";
    Layout = "~/Views/Shared/Layout_Test.cshtml";
}


<form id="registerForm" method="post" action="/Register">
    <!-- Đầu vào tên đăng nhập và mật khẩu hiện tại -->
    <input type="text" id="phone" name="phone" placeholder="Tên đăng nhập" required>
    <input type="password" id="currentPassword" name="currentPassword" placeholder="Mật khẩu hiện tại" required>

    <!-- Đầu vào mật khẩu mới và xác nhận mật khẩu mới -->
    <input type="password" id="password" name="password" placeholder="Mật khẩu mới" required>
    <input type="password" id="confirmPassword" name="confirmPassword" placeholder="Xác nhận mật khẩu mới" required>

    <!-- Nút đăng ký -->
    <button type="submit" id="registerButton">Đăng ký</button>
</form>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        $('#registerForm').submit(function (event) {
            event.preventDefault(); // Ngăn chặn gửi biểu mẫu một cách thông thường

            // Lấy giá trị của các trường đầu vào
            var phone = $('#phone').val();
            var currentPassword = $('#currentPassword').val();
            var password = $('#password').val();
            var confirmPassword = $('#confirmPassword').val();

            // Gửi yêu cầu AJAX để xác minh mật khẩu
            $.ajax({
                url: '/VerifyPassword',
                method: 'POST',
                data: {
                    phone: phone,
                    password: currentPassword
                },
                success: function (response) {
                    if (response === true) {
                        // Mật khẩu hiện tại đúng, tiếp tục với việc đăng ký
                        $('#registerForm')[0].submit();
                    } else {
                        // Mật khẩu hiện tại không đúng, hiển thị thông báo lỗi
                        alert('Mật khẩu hiện tại không đúng.');
                    }
                },
                error: function () {
                    // Xử lý lỗi nếu có
                    alert('Đã xảy ra lỗi khi xác minh mật khẩu.');
                }
            });
        });
    });
</script>


